<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Resume Upload</title>
    <style>
      :root{--bg:#f6f9fc;--card:#ffffff;--accent:#2563eb;--muted:#64748b}
      *{box-sizing:border-box}
      body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:24px; display:flex; align-items:center; justify-content:center; min-height:100vh}
      .card{width:100%; max-width:760px; background:var(--card); border-radius:12px; padding:28px; box-shadow:0 8px 30px rgba(16,24,40,0.08)}
      h1{margin:0 0 8px; font-size:20px}
      p.lead{margin:0 0 18px; color:var(--muted)}
      .dropzone{border:2px dashed #e6eef8; border-radius:10px; padding:28px; text-align:center; cursor:pointer; transition:background .15s, border-color .15s}
      .dropzone.dragover{background:#eef6ff; border-color:var(--accent)}
      .dropzone input{display:none}
      .meta{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:14px}
      .progress{height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; flex:1}
      .progress > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#7c3aed); transition:width .2s}
      .btn{background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer}
      .btn.secondary{background:#f3f4f6; color:#111}
      .msg{margin-top:12px; font-size:14px}
      .small{font-size:13px; color:var(--muted)}
      @media (max-width:520px){.card{padding:18px}}
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Upload your resume</h1>
      <p class="lead">Only PDF files accepted. Maximum file size: 2MB.</p>

      <label class="dropzone" id="dropzone">
        <input type="file" id="fileInput" name="resume" accept="application/pdf">
        <div id="dzPrompt">
          <strong>Drag & drop</strong> your PDF here, or <span style="color:var(--accent); text-decoration:underline;">click to browse</span>
          <div class="small" style="margin-top:8px">Tip: rename large files or compress PDFs if upload fails.</div>
        </div>
      </label>

      <div class="meta">
        <div class="progress" aria-hidden>
          <i id="bar"></i>
        </div>
        <button class="btn" id="uploadBtn" disabled>Upload</button>
        <button class="btn secondary" id="clearBtn">Clear</button>
      </div>

      <div class="msg" id="msg" role="status" aria-live="polite"></div>
    </div>

    <script>
      const dropzone = document.getElementById('dropzone');
      const fileInput = document.getElementById('fileInput');
      const uploadBtn = document.getElementById('uploadBtn');
      const clearBtn = document.getElementById('clearBtn');
      const msg = document.getElementById('msg');
      const bar = document.getElementById('bar');
      let currentFile = null;

      function setMessage(text, ok=true){ msg.textContent = text; msg.style.color = ok ? 'rgb(16,185,129)' : 'rgb(239,68,68)'; }

      dropzone.addEventListener('click', () => fileInput.click());

      ;['dragenter','dragover'].forEach(ev => {
        dropzone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); });
      });
      ;['dragleave','drop'].forEach(ev => {
        dropzone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); });
      });

      dropzone.addEventListener('drop', (e) => {
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        handleFileSelection(f);
      });

      fileInput.addEventListener('change', (e) => handleFileSelection(e.target.files && e.target.files[0]));

      clearBtn.addEventListener('click', () => {
        currentFile = null; fileInput.value = ''; bar.style.width = '0%'; uploadBtn.disabled = true; setMessage('Cleared.');
      });

      function handleFileSelection(file){
        if (!file) return;
        if (file.type !== 'application/pdf') { setMessage('Please select a PDF file.', false); return; }
        if (file.size > 2 * 1024 * 1024) { setMessage('File too large. Max 2MB.', false); return; }
        currentFile = file; setMessage(`Ready: ${file.name}`); uploadBtn.disabled = false; bar.style.width = '0%';
      }

      uploadBtn.addEventListener('click', async () => {
        if (!currentFile) { setMessage('No file chosen.', false); return; }
        uploadBtn.disabled = true; clearBtn.disabled = true; setMessage('Uploading...');

        const fd = new FormData();
        fd.append('resume', currentFile, currentFile.name);

        try{
          const xhr = new XMLHttpRequest();
          xhr.open('POST', '/upload', true);
          xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
              const pct = Math.round((e.loaded / e.total) * 100);
              bar.style.width = pct + '%';
            }
          };
          xhr.onload = () => {
            clearBtn.disabled = false;
            if (xhr.status === 200) {
              try{ const data = JSON.parse(xhr.responseText); if (data.success) { setMessage('Upload successful.'); } else { setMessage(data.message || 'Upload failed', false); } }
              catch(e){ setMessage('Unexpected server response.', false); }
            } else {
              try{ const err = JSON.parse(xhr.responseText); setMessage(err.message || 'Upload failed', false); } catch(e){ setMessage('Upload failed ('+xhr.status+')', false); }
            }
            uploadBtn.disabled = false;
          };
          xhr.onerror = () => { setMessage('Network error during upload.', false); uploadBtn.disabled = false; clearBtn.disabled = false; };
          xhr.send(fd);
        } catch (err) { setMessage('Error: ' + err.message, false); uploadBtn.disabled = false; clearBtn.disabled = false; }
      });
    </script>
  </body>
</html>
